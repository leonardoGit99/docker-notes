
---
**docker-compose.yaml** = archivo que define **varios contenedores y cómo se relacionan**.

- Permite levantar **frontend, backend y base de datos** con un solo comando (`docker compose up -d`).
    
- Define redes internas, volúmenes, variables de entorno y dependencias entre servicios.
- No es necesario crear una red interna, debido a que todo lo que se encuentre dentro de este archivo (docker-compose.yaml), docker sabrá que queremos que esten sobre una misma red, por lo que lo hará automaticamente
- ==Importante: tabulaciones==

>Estructura Básica
```yaml
services:
  frontend:
    build: ./frontend/next-project
    ports:
      - "3000:3000"
    depends_on:
      - backend
    environment:
      - NEXT_PUBLIC_API_URL=http://backend:4000
        
  backend:
    build: ./backend
    ports:
      - "4000:4000"
    depends_on:
      - db
    environment:
      # Base de datos
      DATABASE_URL: postgres://postgres:root@db:5432/covertron
      # JWT
      JWT_SECRET: covertron-secret-key-djkSJdasdJKLSDI-JKDSL-dkls-l-JKSADK-dkddfgdymcu
      # Cloudinary
      CLOUDINARY_CLOUD_NAME: dpdmxp9iq
      CLOUDINARY_API_KEY: 467979913413724
      CLOUDINARY_API_SECRET: HU64cGiQcsH-edrCZr6YvKFicHQ
      
  db:
    image: postgres:15
    restart: always
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: covetrondb
    ports:
      - "5432:5432"
    volumes:
      - db_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
        
volumes:
  db_data:
```


### Comandos

| Comando                                                   | Descripción                                                                                                                                                                                                                                                                                                                   | Ejemplo                           |
| --------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------- |
| `docker compose up`                                       | Levanta todos los servicios definidos en docker-compose.yml (-d) modo detached o segundo plano                                                                                                                                                                                                                                | `docker compose up -d`            |
| `docker compose -f docker-compose-dev.yml up`             | Levanta todos los servicios definidos en nuestro docker compose **customizado para desarrollo** con -f                                                                                                                                                                                                                        |                                   |
| `docker compose -f docker-compose-dev.yml up --build`<br> | - Fuerza a Docker a **reconstruir todas las imágenes** definidas en tu `docker-compose-dev.yml`, incluso si ya existen versiones anteriores en tu máquina.<br>    <br>- Útil cuando **cambiaste algo en el Dockerfile** o en las dependencias (`package.json`, `package-lock.json`) y quieres que se refleje en el container. |                                   |
| `docker compose down`                                     | Detiene y elimina contenedores, redes y volumenes creados                                                                                                                                                                                                                                                                     | `docker compose down`             |
| `docker compose logs -f`                                  | Ver logs de todos los servicios                                                                                                                                                                                                                                                                                               | `docker compose logs -f frontend` |
| `docker compose build <service name>`                     | Reconstruir imágenes definidas en Compose                                                                                                                                                                                                                                                                                     | `docker compose build backend`    |
| `docker compose stop`                                     | Detener contenedores sin eliminarlos                                                                                                                                                                                                                                                                                          |                                   |
| `docker compose start`                                    | Levantar contenedores existentes                                                                                                                                                                                                                                                                                              |                                   |
| `docker compose -f docker-compose-dev.yml down -v`        | Detener y eliminar contenedores y volumenes existentes (util cuando cambiamos el script init.sql)                                                                                                                                                                                                                             |                                   |
